<?xml version="1.0" encoding="utf-8"?>
<timeline>
  <name>VAR, EVAL, 正規表現の動的リコンパイルのテスト</name>
  <rev>rev1</rev>
  <description>
    VAR, EVAL, 正規表現の動的リコンパイルを実施する代表的なテスト
  </description>
  <author>anoyetta</author>
  <license>CC BY-SA</license>
  <zone>TEST</zone>
  <locale>JA</locale>
  <start>0039::戦闘開始！</start>

  
  <a time="003" text="応用編へ" goto="応用編" />

  <a time="005" text="変数セット1">
    <expressions>
      <set name="A" value="EVAL(4/2)" />
      <set name="hoge" value="4" />
      <set name="skill" value="闇の攻撃" />
      <set name="hex" value="0x0F" />
    </expressions>
  </a>

  <!-- 変数VAR[] と 演算EVAL() を組合せたテスト1 真となる演算 -->
  <a time="015" text="変数評価A - EVAL false">
    <expressions>
      <pre name="A" value="EVAL(VAR['hoge']/2, N0)" />
      <!-- 
        EVAL(式, [書式]) 
        第2引数の書式は省力しても良い。整数を16進数の文字列として出力したい場合などに使用する
      -->
    </expressions>
          <v-notice
        text="EVAL(VAR['hoge']/2, N0)"
        icon="サイコロ1.png"
        duration="5" />
  </a>

  <!-- 変数VAR[] と 演算EVAL() を組合せたテスト2 偽となる演算 -->
  <a time="025" text="変数評価B - EVAL true">
    <expressions>
      <pre name="A" value="EVAL(VAR['hoge']/4, N0)" />
    </expressions>
          <v-notice
        text="EVAL(VAR['hoge']/4, N0)"
        icon="サイコロ2.png"
        duration="5" />
  </a>

  @{
    var offset = 0x01;
  }

  <!-- 
    16進数を扱う場合はRazorの変数を経由する。
    EVAL内の式では 0x 表記の16進数を扱えないため。
  -->
  <a time="035" text="変数評価C - offset by HEX">
    <expressions>
      <pre name="A" value="EVAL(1 + @offset, N0)" />
    </expressions>
    
          <v-notice
        text="EVAL(1 + @offset, N0)"
        icon="サイコロ3.png"
        duration="5" />
  </a>

  <a time="045" text="変数評価D - HEX">
    <expressions>
      <pre name="hex" value="15" />
    </expressions>
          <v-notice
        text="15"
        icon="サイコロ5.png"
        duration="5" />
  </a>

  <!-- これらのアクティビティは skill がセットされたときにリコンパイルされる -->
  <a time="055" name="変数ありActivity1" text="動的正規表現1" sync="starts using VAR['skill']" >
  
      <dump target="Log" log="starts using 闇の攻撃" />
  </a>
  <a time="065" name="変数ありActivity2" text="動的正規表現2" sync="starts using VAR['skill']" >
  
      <dump target="Log" log="starts using 闇の攻撃" />
  </a>

    <t name="DEBUGサイン 0x00" sync="starts using VAR['skill']">
      <v-notice text="starts using" />
    </t>


  <s name="応用編">
    <a time="005" name="サイン判定の準備完了" text="サイン判定の準備完了">
      <expressions> <!-- 変数の初期化 -->
        <set name="impulse_target_count" value="0" />
      </expressions>

            <v-notice
        text="DEBUGA VAR['impulse_target_count'] DEBUGA"
        duration="5" />
    </a>

    <a time="025" name="サイン判定" text="サイン判定">
            <v-notice
        text="DEBUGB VAR['impulse_target_count'] DEBUGB"
        duration="5" />
    </a>
    <a time="030" text="サイン1発生">
      <dump target="Log" log="15:12345678:ヘスペロス:6A1C:フリーティングインパルス:12345678:Taro Yamada:0000:0000:1F01:" />
    </a>

    <a time="031" text="サイン2発生">
      <dump target="Log" log="15:12345678:ヘスペロス:6A1C:フリーティングインパルス:12345678:Taro Yamada:0000:0000:1F01:" />
    </a>

    <a time="032" text="サイン3発生">
      <dump target="Log" log="15:12345678:ヘスペロス:6A1C:フリーティングインパルス:12345678:Taro Yamada:0000:0000:1F01:" />
    </a>

    <a time="033" text="サイン4発生">
      <dump target="Log" log="15:12345678:ヘスペロス:6A1C:フリーティングインパルス:12345678:Taro Yamada:0000:0000:1F01:" />
    </a>

    <a time="034" text="サイン5発生">
      <dump target="Log" log="15:12345678:ヘスペロス:6A1C:フリーティングインパルス:12345678:Taro Yamada:0000:0000:1F01:" />
    </a>

    <a time="035" text="サイン6発生">
      <dump target="Log" log="15:12345678:ヘスペロス:6A1C:フリーティングインパルス:12345678:Taro Yamada:0000:0000:1F01:" />
    </a>

    <a time="036" text="サイン7発生">
      <dump target="Log" log="15:12345678:ヘスペロス:6A1C:フリーティングインパルス:12345678:Mani Ax:0000:0000:1F01:" />
    </a>

    <a time="037" text="サイン8発生">
      <dump target="Log" log="15:12345678:ヘスペロス:6A1C:フリーティングインパルス:12345678:Taro Yamada:0000:0000:1F01:" />
    </a>

    <t no="1" name="インパルス対象カウント" sync="15:[id8]:ヘスペロス:6A1C:フリーティングインパルス:" >
      <expressions>
        <set name="impulse_target_count" value="EVAL(VAR['impulse_target_count']+1,N0)" />
      </expressions>
            <v-notice
        text="DEBUGC VAR['impulse_target_count'] DEBUGC"
        duration="5" />
    </t>

    <t no="2" name="何番目にインパルス対象になったかの判定" sync="15:[id8]:ヘスペロス:6A1C:フリーティングインパルス:[id8]:[mex]:" sync-count="1" >
      <v-notice
        text="VAR['impulse_target_count']個目の塔に入る"
        duration="23" />
    </t>

  </s>
</timeline>
